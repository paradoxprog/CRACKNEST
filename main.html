<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrackNest | AI Dashboard</title>
    <meta name="description" content="Your AI-powered, personalized interview preparation dashboard.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5', // Indigo 600
                        secondary: '#F59E0B', // Amber 500
                        dark: '#0F172A', // Slate 900
                        light: '#F8FAFC', // Slate 50
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        heading: ['Poppins', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05); }
        #sidebar { transition: transform 0.3s ease-in-out; }
        @media (max-width: 767px) {
            #sidebar { transform: translateX(-100%); }
            #sidebar.active { transform: translateX(0); }
        }
        /* Loading Animation */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4F46E5;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="font-sans text-slate-600 bg-light antialiased min-h-screen">

    <nav class="fixed w-full z-50 bg-white/90 backdrop-blur-md border-b border-slate-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex-shrink-0 flex items-center gap-2 cursor-pointer">
                    <span class="font-heading font-bold text-2xl text-slate-800">Crack<span class="text-primary">Nest</span></span>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-3">
                           <div id="user-avatar" class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center font-bold shadow-md">U</div>
                           <div class="hidden lg:block">
                               <p id="user-name" class="text-sm font-bold text-slate-800 leading-none">User</p>
                               <button id="logout-btn" class="text-xs text-red-500 hover:text-red-700 font-medium">Sign Out</button>
                           </div>
                       </div>
                   </div>
                    <button id="mobile-sidebar-btn" class="md:hidden text-slate-600 hover:text-primary focus:outline-none">
                        <i class="fa-solid fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <div class="flex pt-20">
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-40 w-64 bg-white border-r border-slate-100 p-6 md:relative md:translate-x-0 flex-shrink-0">
            <h3 class="font-heading font-bold text-lg text-slate-900 mb-6 mt-4">Dashboard</h3>
            <nav class="space-y-2">
                <a href="#overview" class="flex items-center gap-3 p-3 rounded-lg text-white bg-primary font-medium transition"><i class="fa-solid fa-gauge"></i> Overview</a>
                <a href="#profile-setup" class="flex items-center gap-3 p-3 rounded-lg text-slate-600 hover:bg-slate-100 transition"><i class="fa-solid fa-user-gear"></i> Profile Setup</a>
                <a href="#skill-test" class="flex items-center gap-3 p-3 rounded-lg text-slate-600 hover:bg-slate-100 transition"><i class="fa-solid fa-clipboard-check"></i> Baseline Test</a>
                <a href="#training" class="flex items-center gap-3 p-3 rounded-lg text-slate-600 hover:bg-slate-100 transition"><i class="fa-solid fa-code-branch"></i> AI Roadmap</a>
                <a href="#test-series" class="flex items-center gap-3 p-3 rounded-lg text-slate-600 hover:bg-slate-100 transition"><i class="fa-solid fa-vials"></i> Test Series</a>
                <a href="#ai-mock" class="flex items-center gap-3 p-3 rounded-lg text-slate-600 hover:bg-slate-100 transition"><i class="fa-solid fa-robot"></i> AI Mock Interview</a>
                <a href="#resume-builder" class="flex items-center gap-3 p-3 rounded-lg text-slate-600 hover:bg-slate-100 transition"><i class="fa-solid fa-file-invoice"></i> Resume Builder</a>
                <a href="#final-eval" class="flex items-center gap-3 p-3 rounded-lg text-slate-600 hover:bg-slate-100 transition"><i class="fa-solid fa-certificate"></i> Final Evaluation</a>
            </nav>
        </aside>

        <main class="flex-1 p-4 sm:p-6 lg:p-8">
            
            <div id="key-warning" class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-6" role="alert">
                <p class="font-bold">Setup Required</p>
                <p>Please open the code and paste your Google Gemini API Key in the <code>GEMINI_API_KEY</code> variable to enable AI features.</p>
            </div>

            <section id="overview" class="mb-10">
                <h1 class="font-heading text-3xl font-bold text-slate-900 mb-2" id="greeting-name">Welcome!</h1>
                <p class="text-slate-500 text-lg">Your personalized AI roadmap to interview success.</p>
                <div class="mt-6 p-6 bg-primary/10 rounded-xl border border-primary/20 flex items-center justify-between">
                    <div>
                        <p class="text-sm font-semibold text-primary">Readiness Score:</p>
                        <span class="font-heading text-4xl font-bold text-primary" id="readiness-score">--%</span>
                    </div>
                    <div class="text-right">
                        <p class="text-sm font-semibold text-primary">Target Role:</p>
                        <span class="text-primary font-bold" id="target-role">N/A</span>
                    </div>
                </div>
            </section>

            <section id="profile-setup" class="mb-16">
                <div class="bg-white p-8 rounded-2xl card-shadow border border-slate-100">
                    <h2 class="font-heading text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <i class="fa-solid fa-user-gear text-primary"></i> 3. Profile Setup
                        <button id="edit-profile-btn" class="text-sm text-primary hover:text-indigo-700 font-medium ml-auto"><i class="fa-solid fa-pen"></i> Edit</button>
                    </h2>
                    
                    <div id="profile-display-view">
                        <div class="grid lg:grid-cols-3 gap-8">
                            <div class="p-6 border border-slate-100 rounded-xl">
                                <h3 class="font-bold text-lg text-slate-800 mb-3"><i class="fa-solid fa-address-card text-secondary"></i> Personal Info</h3>
                                <ul class="space-y-2 text-sm" id="personal-info-list">
                                    <li><strong>Name:</strong> <span data-field="name">N/A</span></li>
                                    <li><strong>Degree:</strong> <span data-field="degree">N/A</span></li>
                                    <li><strong>Year:</strong> <span data-field="year">N/A</span></li>
                                </ul>
                            </div>
                            <div class="p-6 border border-slate-100 rounded-xl">
                                <h3 class="font-bold text-lg text-slate-800 mb-3"><i class="fa-solid fa-bullseye text-green-600"></i> Career Target</h3>
                                <ul class="space-y-2 text-sm">
                                    <li><strong>Field:</strong> <span data-field="field">N/A</span></li>
                                    <li><strong>Role:</strong> <span data-field="role">N/A</span></li>
                                </ul>
                            </div>
                            <div class="p-6 border border-slate-100 rounded-xl">
                                <h3 class="font-bold text-lg text-slate-800 mb-3"><i class="fa-solid fa-briefcase text-purple-600"></i> Experience</h3>
                                <p class="text-sm"><span data-field="experience">N/A</span></p>
                            </div>
                        </div>
                    </div>

                    <form id="profile-edit-form" class="hidden space-y-6 mt-4">
                        <div class="grid md:grid-cols-2 gap-4">
                            <input type="text" id="name" placeholder="Name" required class="border p-2 rounded-lg">
                            <input type="text" id="degree" placeholder="Degree" required class="border p-2 rounded-lg">
                            <input type="number" id="year" placeholder="Year" required class="border p-2 rounded-lg">
                            <input type="text" id="languages" placeholder="Languages" class="border p-2 rounded-lg">
                            <input type="text" id="certifications" placeholder="Certifications" class="border p-2 rounded-lg md:col-span-2">
                        </div>
                        <div class="grid md:grid-cols-2 gap-4">
                            <select id="field" required class="border p-2 rounded-lg">
                                <option value="">Select Field</option>
                                <option value="IT">IT/Technology</option>
                                <option value="Marketing">Marketing</option>
                                <option value="HR">HR</option>
                                <option value="Finance">Finance</option>
                            </select>
                            <input type="text" id="role" placeholder="Target Role (e.g., Backend Dev)" required class="border p-2 rounded-lg">
                        </div>
                        <select id="experience" required class="border p-2 rounded-lg w-full">
                            <option value="Fresher">Fresher (0-1 Year)</option>
                            <option value="Experienced">Experienced (1+ Years)</option>
                        </select>
                        <button type="submit" class="bg-primary text-white px-6 py-2 rounded-lg font-bold">Save Profile</button>
                    </form>
                </div>
            </section>

            <section id="skill-test" class="mb-16">
                <div class="bg-white p-8 rounded-2xl card-shadow border border-slate-100">
                    <h2 class="font-heading text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <i class="fa-solid fa-clipboard-check text-secondary"></i> 4. Baseline Skill Test
                    </h2>
                    <div id="test-results" class="bg-indigo-50 p-5 rounded-lg border border-indigo-100">
                        <div class="grid grid-cols-3 gap-4 text-sm font-medium">
                            <p><strong>Score:</strong> <span id="test-readiness-score" class="text-primary font-bold">--%</span></p>
                            <p><strong>Strength:</strong> <span id="test-strength">N/A</span></p>
                            <p><strong>Weakness:</strong> <span id="test-weakness">N/A</span></p>
                        </div>
                        <p id="test-analysis" class="mt-4 text-sm text-slate-700 italic">Analysis pending...</p>
                        <button id="take-test-btn" class="mt-4 bg-primary text-white px-6 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition">
                            Take AI Assessment
                        </button>
                    </div>
                </div>
            </section>
            
            <section id="training" class="mb-16">
                <div class="bg-white p-8 rounded-2xl card-shadow border border-slate-100">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="font-heading text-2xl font-bold text-slate-900 flex items-center gap-3">
                            <i class="fa-solid fa-route text-primary"></i> 5. AI Training Roadmap
                        </h2>
                        <div id="roadmap-loader" class="loader hidden"></div>
                    </div>
                    
                    <div class="grid lg:grid-cols-3 gap-8">
                        <div class="p-6 bg-blue-50 rounded-xl border border-blue-100">
                            <h3 class="font-bold text-xl text-blue-600 mb-2">Aptitude</h3>
                            <p class="text-sm">Standard Quants & Logic.</p>
                        </div>
                        <div class="p-6 bg-purple-50 rounded-xl border border-purple-100">
                            <h3 class="font-bold text-xl text-purple-600 mb-2" id="domain-title">Technical</h3>
                            <p class="text-xs font-semibold text-purple-600 mb-2">Focus: <span id="domain-focus">N/A</span></p>
                            <ul class="space-y-2 text-sm" id="domain-topics">
                                <li>Topics pending AI generation...</li>
                            </ul>
                        </div>
                        <div class="p-6 bg-green-50 rounded-xl border border-green-100">
                            <h3 class="font-bold text-xl text-green-600 mb-2">HR Prep</h3>
                            <p class="text-sm">Behavioral skills.</p>
                        </div>
                    </div>
                    <div class="mt-6 bg-light p-4 rounded-lg">
                        <h3 class="font-bold text-sm text-slate-800">AI Strategy:</h3>
                        <p id="ai-roadmap-summary" class="text-sm text-slate-600 mt-1">Please take the test to generate roadmap.</p>
                        <button id="regenerate-roadmap" class="text-primary text-xs font-medium mt-2 hover:underline">Regenerate with AI</button>
                    </div>
                </div>
            </section>
            
            <section id="resume-builder" class="mb-16">
                <div class="bg-white p-8 rounded-2xl card-shadow border border-slate-100">
                    <h2 class="font-heading text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <i class="fa-solid fa-file-invoice text-primary"></i> 7. Resume Builder
                    </h2>
                    <div class="bg-light p-6 rounded-xl border border-slate-200">
                        <h3 class="font-bold text-slate-800 mb-3"><i class="fa-solid fa-robot text-purple-500"></i> AI Suggestions</h3>
                        <ul class="space-y-2 text-sm text-slate-600" id="ai-resume-suggestions">
                            <li>Pending AI analysis...</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <section id="ai-mock" class="mb-16">
                <div class="bg-dark p-8 rounded-2xl card-shadow">
                    <h2 class="font-heading text-2xl font-bold text-white mb-6 flex items-center gap-3">
                        <i class="fa-solid fa-robot text-purple-400"></i> 8. AI Mock Interview
                    </h2>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
                            <h3 class="font-bold text-white mb-2">HR Round</h3>
                            <button id="start-hr-mock" class="bg-green-500 text-white px-4 py-2 rounded text-sm hover:bg-green-600">Simulate HR Question</button>
                        </div>
                        <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
                            <h3 class="font-bold text-white mb-2">Technical Round</h3>
                            <button id="start-tech-mock" class="bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600">Simulate Tech Question</button>
                        </div>
                    </div>
                    <div class="mt-6 bg-slate-700 p-4 rounded-lg">
                        <p id="ai-mock-feedback" class="text-sm text-slate-300">Click a button to start a simulation.</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script type="module">
        // =================================================================
        // ðŸ”‘ CONFIGURATION: INSERT YOUR API KEY BELOW
        // =================================================================
        
        // REPLACE THE EMPTY STRING BELOW WITH YOUR ACTUAL KEY
        const GEMINI_API_KEY = "AIzaSyC0inV4Bpo3iG-36QKQCM-rKOFfX6Z1k3A"; 

        // =================================================================

        const GEMINI_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${GEMINI_API_KEY}`;

        // Check if key is present
        if (!GEMINI_API_KEY) {
            document.getElementById('key-warning').style.display = 'block';
            console.error("Gemini API Key is missing.");
        } else {
            document.getElementById('key-warning').style.display = 'none';
        }

        // --- Core Gemini API Function ---
        async function callGemini(prompt) {
            if (!GEMINI_API_KEY) {
                alert("Please add your API Key in the code (line ~380) to use AI features.");
                return null;
            }

            try {
                const response = await fetch(GEMINI_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { responseMimeType: "application/json" } // Force JSON
                    })
                });

                if (!response.ok) throw new Error(`API Error: ${response.statusText}`);
                
                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                return JSON.parse(text); // Parse the JSON response
            } catch (error) {
                console.error("Gemini AI Error:", error);
                alert("AI Generation failed. Check console for details (or Invalid API Key).");
                return null;
            }
        }

        // --- Data Management ---
        const DEFAULT_PROFILE = { name: 'User', field: 'IT', role: 'Developer', experience: 'Fresher' };
        const getProfile = () => JSON.parse(localStorage.getItem('cn_profile')) || DEFAULT_PROFILE;
        const saveProfile = (p) => { localStorage.setItem('cn_profile', JSON.stringify(p)); updateUI(); };
        const getResults = () => JSON.parse(localStorage.getItem('cn_results')) || { score: '--', strength: 'N/A', weakness: 'N/A' };
        
        // --- Feature Logic ---

        // 1. Generate Roadmap
        async function generateRoadmap() {
            const p = getProfile();
            const r = getResults();
            const loader = document.getElementById('roadmap-loader');
            loader.classList.remove('hidden');

            const prompt = `
                Act as a career mentor. Generate a training roadmap for a ${p.experience} ${p.role} in ${p.field}.
                The student has a score of ${r.score}%. Strength: ${r.strength}. Weakness: ${r.weakness}.
                Return ONLY a JSON object with this structure:
                {
                    "domainTitle": "Short Title for Technical Module",
                    "domainFocus": "Specific focus area based on weakness",
                    "topics": ["Topic 1", "Topic 2", "Topic 3"],
                    "strategy": "A 1-sentence strategic advice summary."
                }
            `;

            const data = await callGemini(prompt);
            loader.classList.add('hidden');

            if (data) {
                document.getElementById('domain-title').textContent = data.domainTitle;
                document.getElementById('domain-focus').textContent = data.domainFocus;
                document.getElementById('ai-roadmap-summary').textContent = data.strategy;
                const list = document.getElementById('domain-topics');
                list.innerHTML = '';
                data.topics.forEach(t => list.innerHTML += `<li>â€¢ ${t}</li>`);
            }
        }

        // 2. Generate Resume Suggestions
        async function generateResumeTips() {
            const p = getProfile();
            const r = getResults();
            
            const prompt = `
                Act as an HR Expert. Provide 3 specific resume bullet point improvements for a ${p.role} who is weak in ${r.weakness} but strong in ${r.strength}.
                Return ONLY a JSON object: { "tips": ["Tip 1", "Tip 2", "Tip 3"] }
            `;

            const data = await callGemini(prompt);
            if (data) {
                const list = document.getElementById('ai-resume-suggestions');
                list.innerHTML = '';
                data.tips.forEach(t => list.innerHTML += `<li class="mb-1"><i class="fa-solid fa-check text-green-500 mr-2"></i>${t}</li>`);
            }
        }

        // 3. Mock Interview Simulation
        async function runMockInterview(type) {
            const p = getProfile();
            const prompt = `
                Generate a challenging ${type} interview question for a ${p.role} (${p.experience}).
                Also provide a short "Ideal Answer Key" explanation.
                Return ONLY a JSON object: { "question": "The question text", "feedback": "What a good answer looks like" }
            `;
            
            const box = document.getElementById('ai-mock-feedback');
            box.innerHTML = '<span class="animate-pulse">AI is thinking...</span>';
            
            const data = await callGemini(prompt);
            if (data) {
                box.innerHTML = `
                    <p class="font-bold text-white mb-2">ðŸ¤– AI Question:</p>
                    <p class="text-lg text-white mb-4">"${data.question}"</p>
                    <div class="bg-slate-600 p-3 rounded text-xs">
                        <span class="font-bold text-green-400">Target Answer:</span> ${data.feedback}
                    </div>
                `;
            }
        }

        // --- Event Listeners ---
        
        // Take Test (Simulated + AI Analysis)
        document.getElementById('take-test-btn').addEventListener('click', async () => {
            const score = Math.floor(Math.random() * 30) + 60; // Random 60-90
            const strengths = ['Data Structures', 'Communication', 'Logical Reasoning'];
            const weaknesses = ['System Design', 'Core Domain', 'Time Management'];
            
            const results = {
                score: score,
                strength: strengths[Math.floor(Math.random()*strengths.length)],
                weakness: weaknesses[Math.floor(Math.random()*weaknesses.length)]
            };
            
            localStorage.setItem('cn_results', JSON.stringify(results));
            updateUI();
            
            // Trigger AI Analysis
            document.getElementById('test-analysis').textContent = "Analyzing with Gemini...";
            const p = getProfile();
            const prompt = `Analyze this test result: Score ${score}%, Strength ${results.strength}, Weakness ${results.weakness} for a ${p.role}. Give a 1 sentence encouraging summary. Return JSON: {"summary": "text"}`;
            const data = await callGemini(prompt);
            if(data) document.getElementById('test-analysis').textContent = data.summary;

            // Update other AI components
            generateRoadmap();
            generateResumeTips();
        });

        document.getElementById('regenerate-roadmap').addEventListener('click', generateRoadmap);
        document.getElementById('start-hr-mock').addEventListener('click', () => runMockInterview('HR Behavioral'));
        document.getElementById('start-tech-mock').addEventListener('click', () => runMockInterview('Technical'));

        // Profile UI Handling
        const form = document.getElementById('profile-edit-form');
        const display = document.getElementById('profile-display-view');
        
        document.getElementById('edit-profile-btn').addEventListener('click', () => {
            form.classList.toggle('hidden');
            display.classList.toggle('hidden');
        });

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const p = {
                name: document.getElementById('name').value,
                degree: document.getElementById('degree').value,
                year: document.getElementById('year').value,
                field: document.getElementById('field').value,
                role: document.getElementById('role').value,
                experience: document.getElementById('experience').value
            };
            saveProfile(p);
            form.classList.add('hidden');
            display.classList.remove('hidden');
        });

        // Initialize
        function updateUI() {
            const p = getProfile();
            const r = getResults();
            
            // Update Text Fields
            document.getElementById('user-name').textContent = p.name;
            document.getElementById('greeting-name').textContent = `Welcome, ${p.name}!`;
            document.querySelector('[data-field="name"]').textContent = p.name;
            document.querySelector('[data-field="degree"]').textContent = p.degree || 'N/A';
            document.querySelector('[data-field="year"]').textContent = p.year || 'N/A';
            document.querySelector('[data-field="field"]').textContent = p.field;
            document.querySelector('[data-field="role"]').textContent = p.role;
            document.querySelector('[data-field="experience"]').textContent = p.experience;
            document.getElementById('target-role').textContent = p.role;

            // Update Test Results
            document.getElementById('readiness-score').textContent = r.score + '%';
            document.getElementById('test-readiness-score').textContent = r.score + '%';
            document.getElementById('test-strength').textContent = r.strength;
            document.getElementById('test-weakness').textContent = r.weakness;
            
            // Populate Form
            document.getElementById('name').value = p.name;
            document.getElementById('role').value = p.role;
        }

        updateUI();
        
        // Mobile Sidebar
        document.getElementById('mobile-sidebar-btn').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('active');
        });
    </script>
</body>
</html>
