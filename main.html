<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CrackNest - Blueprint | AI Career Prep</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #0ea5e9;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --success: #10b981;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body { background-color: var(--bg); color: var(--text); line-height: 1.6; padding-bottom: 50px; }

        /* Utilities */
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .hidden { display: none !important; }
        .btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 1rem; transition: 0.2s; }
        .btn:hover { background: var(--primary-dark); }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-outline:hover { background: var(--primary); color: white; }
        .card { background: var(--card-bg); padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0 20px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 1rem; }
        
        /* Header */
        header { background: white; padding: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 10px; }
        
        /* Specific Sections */
        .step-indicator { display: flex; gap: 10px; margin-bottom: 20px; font-size: 0.9rem; color: var(--text-light); overflow-x: auto; }
        .step-indicator span.active { color: var(--primary); font-weight: bold; border-bottom: 2px solid var(--primary); }

        /* Dashboard */
        .dash-stat { text-align: center; padding: 20px; background: #e0e7ff; border-radius: 8px; }
        .dash-stat h3 { font-size: 2rem; color: var(--primary); }

        /* Chat Interface */
        .chat-box { height: 400px; border: 1px solid #e2e8f0; border-radius: 8px; overflow-y: auto; padding: 15px; margin-bottom: 15px; background: #f1f5f9; display: flex; flex-direction: column; gap: 10px; }
        .message { padding: 10px 15px; border-radius: 10px; max-width: 80%; }
        .bot-msg { background: white; align-self: flex-start; border: 1px solid #e2e8f0; }
        .user-msg { background: var(--primary); color: white; align-self: flex-end; }
        .controls { display: flex; gap: 10px; }

        /* Loading */
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <header>
        <div class="container">
            <div class="logo">üåê CrackNest <span style="font-size: 0.9rem; color: #666; font-weight: normal;">Blueprint</span></div>
        </div>
    </header>

    <div class="container">
        
        <div id="section-api" class="card">
            <h2>üîê System Setup</h2>
            <p>To power the AI features, please enter your Google Gemini API Key.</p>
            <input type="password" id="apiKeyInput" placeholder="Enter Gemini API Key (begins with AIza...)">
            <button class="btn" onclick="saveApiKey()">Start CrackNest</button>
            <p style="font-size: 0.8rem; color: #666; margin-top: 10px;">The key is stored locally in your browser session only.</p>
        </div>

        <div id="nav-steps" class="hidden step-indicator">
            <span id="nav-profile">1. Profile</span>
            <span id="nav-baseline">2. Baseline Test</span>
            <span id="nav-dashboard">3. Dashboard</span>
            <span id="nav-resume">4. Resume</span>
            <span id="nav-mock">5. AI Mock Interview</span>
            <span id="nav-eval">6. Final Eval</span>
        </div>

        <div id="section-profile" class="card hidden">
            <h2>üë§ Profile Setup</h2>
            <div class="grid">
                <div>
                    <label>Full Name</label>
                    <input type="text" id="p-name" placeholder="John Doe">
                </div>
                <div>
                    <label>Degree / Stream</label>
                    <input type="text" id="p-degree" placeholder="B.Tech Computer Science">
                </div>
                <div>
                    <label>Target Role</label>
                    <input type="text" id="p-role" placeholder="Software Developer">
                </div>
                <div>
                    <label>Experience Level</label>
                    <select id="p-exp">
                        <option value="Fresher">Fresher</option>
                        <option value="1-3 Years">1-3 Years</option>
                        <option value="3+ Years">3+ Years</option>
                    </select>
                </div>
            </div>
            <label>Skills / Certifications</label>
            <textarea id="p-skills" rows="2" placeholder="Java, Python, AWS Cloud Practitioner..."></textarea>
            
            <button class="btn" onclick="submitProfile()">Build My Plan</button>
            <div id="loader-profile" class="loader"></div>
        </div>

        <div id="section-baseline" class="card hidden">
            <h2>üéØ Baseline Assessment</h2>
            <p>Answer these quick questions to let our AI gauge your level for <strong><span id="lbl-role"></span></strong>.</p>
            <hr style="margin: 20px 0;">
            
            <div id="baseline-questions">
                </div>

            <button class="btn" onclick="submitBaseline()">Analyze & Generate Roadmap</button>
            <div id="loader-baseline" class="loader"></div>
        </div>

        <div id="section-dashboard" class="hidden">
            <div class="card" style="background: linear-gradient(135deg, #4f46e5 0%, #818cf8 100%); color: white;">
                <h2>üëã Welcome back, <span id="dash-name">User</span></h2>
                <p>Current Status: <strong id="dash-status">Learning Phase</strong></p>
                <div style="margin-top: 15px;">
                    <div style="font-size: 2rem; font-weight: bold;" id="dash-score">0%</div>
                    <div>Interview Readiness Score</div>
                </div>
            </div>

            <div class="grid">
                <div class="card">
                    <h3>üìò Aptitude Training</h3>
                    <p>Quantitative, Logical, Verbal.</p>
                    <button class="btn-outline" style="margin-top:10px">Start Practice</button>
                </div>
                <div class="card">
                    <h3>üíª Technical Training</h3>
                    <p id="dash-tech-text">Coding & Domain Concepts.</p>
                    <button class="btn-outline" style="margin-top:10px">Start Coding</button>
                </div>
                <div class="card">
                    <h3>üéô HR Skills</h3>
                    <p>Confidence & Communication.</p>
                    <button class="btn-outline" style="margin-top:10px">View Lessons</button>
                </div>
            </div>

            <div class="card">
                <h3>üó∫Ô∏è Your Custom Roadmap (AI Generated)</h3>
                <div id="dashboard-roadmap" style="white-space: pre-wrap; background: #f1f5f9; padding: 15px; border-radius: 6px; font-size: 0.9rem;">
                    Loading roadmap...
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="goToSection('section-test-series')">Go to Test Series & Resume Builder</button>
            </div>
        </div>

        <div id="section-test-series" class="card hidden">
            <h2>üõ† Tools & Tests</h2>
            
            <h3>Test Series Levels</h3>
            <div class="grid" style="margin-bottom: 30px;">
                <div style="border:1px solid #eee; padding: 15px; border-radius: 8px;">
                    <h4>Level 1: Aptitude</h4>
                    <p>Analytics + Solutions</p>
                    <button class="btn-outline">Take Test</button>
                </div>
                <div style="border:1px solid #eee; padding: 15px; border-radius: 8px;">
                    <h4>Level 2: Technical</h4>
                    <p>Role-based Coding</p>
                    <button class="btn-outline">Take Test</button>
                </div>
                <div style="border:1px solid #eee; padding: 15px; border-radius: 8px;">
                    <h4>Level 3: HR</h4>
                    <p>Scenario Questions</p>
                    <button class="btn-outline">Take Test</button>
                </div>
            </div>

            <hr>

            <h3>üìÑ AI Resume Builder</h3>
            <p>Paste your professional summary below, and our AI will rewrite it to be ATS-friendly.</p>
            <textarea id="resume-input" rows="3" placeholder="I am a hard worker looking for a job in coding. I know Java."></textarea>
            <button class="btn" onclick="optimizeResume()">‚ú® AI Optimize Summary</button>
            <div id="resume-output" style="margin-top: 15px; background: #ecfdf5; padding: 15px; border-radius: 6px; display: none; color: #065f46;"></div>
            <div id="loader-resume" class="loader"></div>

            <div style="text-align: right; margin-top: 20px;">
                <button class="btn" onclick="goToSection('section-mock')">Proceed to AI Mock Interview ‚Üí</button>
            </div>
        </div>

        <div id="section-mock" class="card hidden">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>ü§ñ AI Mock Interview</h2>
                <select id="interview-mode" style="width: auto; margin: 0;">
                    <option value="HR">HR Round</option>
                    <option value="Technical">Technical Round</option>
                </select>
            </div>
            <p style="margin-bottom: 10px; font-size: 0.9rem;">Mode: <span id="lbl-mode">HR</span> | Role: <span id="lbl-mock-role"></span></p>

            <div class="chat-box" id="chat-container">
                <div class="message bot-msg">Hello! I am your AI Interviewer. Are you ready to begin?</div>
            </div>

            <div class="controls">
                <input type="text" id="user-input" placeholder="Type your answer here..." style="margin-bottom: 0;">
                <button class="btn" onclick="sendMessage()">Send</button>
            </div>
            <div style="text-align: center; margin-top: 10px;">
                 <button class="btn-outline" style="border-color: #ef4444; color: #ef4444;" onclick="endInterview()">End Interview & Get Evaluation</button>
            </div>
        </div>

        <div id="section-eval" class="card hidden">
            <h2>üèÜ Final Performance Summary</h2>
            <div class="dash-stat" style="background: #ecfdf5;">
                <h3 style="color: #059669;" id="final-score">85/100</h3>
                <p>Interview Readiness</p>
            </div>
            
            <h4 style="margin-top: 20px;">AI Feedback Report:</h4>
            <div id="eval-content" style="white-space: pre-wrap; margin-top: 10px; color: #334155;"></div>
            
            <button class="btn" style="margin-top: 20px;" onclick="location.reload()">Start Over</button>
        </div>

    </div>

    <script>
        // State
        let apiKey = '';
        let userProfile = {};
        let chatHistory = [];
        let score = 0;

        // --- Navigation ---
        function goToSection(id) {
            document.querySelectorAll('.container > div').forEach(div => {
                if(div.id !== 'nav-steps') div.classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
            
            // Update Nav Indicator
            document.querySelectorAll('.step-indicator span').forEach(span => span.classList.remove('active'));
            if(id === 'section-profile') document.getElementById('nav-profile').classList.add('active');
            if(id === 'section-baseline') document.getElementById('nav-baseline').classList.add('active');
            if(id === 'section-dashboard') document.getElementById('nav-dashboard').classList.add('active');
            if(id === 'section-test-series') document.getElementById('nav-resume').classList.add('active');
            if(id === 'section-mock') document.getElementById('nav-mock').classList.add('active');
            if(id === 'section-eval') document.getElementById('nav-eval').classList.add('active');
        }

        function saveApiKey() {
            const input = document.getElementById('apiKeyInput').value;
            if(input.length > 10) {
                apiKey = input;
                document.getElementById('section-api').classList.add('hidden');
                document.getElementById('nav-steps').classList.remove('hidden');
                goToSection('section-profile');
            } else {
                alert("Please enter a valid API Key");
            }
        }

        // --- GEMINI API HELPER ---
        async function callGemini(prompt, systemInstruction = "") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("API Error", error);
                return "Error connecting to AI. Please check your API key.";
            }
        }

        // --- Profile & Roadmap ---
        async function submitProfile() {
            userProfile = {
                name: document.getElementById('p-name').value,
                role: document.getElementById('p-role').value,
                exp: document.getElementById('p-exp').value,
                skills: document.getElementById('p-skills').value
            };

            if(!userProfile.name || !userProfile.role) { alert("Please fill details"); return; }

            document.getElementById('loader-profile').style.display = 'block';

            // Generate baseline questions based on role
            const prompt = `Generate 3 short multiple choice technical questions (A, B, C, D) for a ${userProfile.role} with ${userProfile.exp} experience. Format: Question | Option A | Option B | Option C | Option D. Separated by new lines.`;
            
            const questionsRaw = await callGemini(prompt, "You are a technical recruiter.");
            
            // Simulating Parsing for the Baseline View
            const lines = questionsRaw.split('\n').filter(line => line.length > 5).slice(0, 3); // simplistic parse
            
            const qContainer = document.getElementById('baseline-questions');
            qContainer.innerHTML = '';
            
            // If parsing fails (AI varies), fall back to generic
            const displayQs = lines.length > 0 ? lines : ["What is the complexity of Binary Search? | O(n) | O(log n) | O(1) | O(n^2)", "Define OOP? | Object | Oriented | Programming | All"];

            displayQs.forEach((q, index) => {
                const parts = q.split('|');
                let html = `<div style="margin-bottom:15px;"><strong>Q${index+1}: ${parts[0]}</strong><br>`;
                if(parts.length > 1) html += `<input type="radio" name="q${index}"> ${parts[1]} <input type="radio" name="q${index}"> ${parts[2]} <input type="radio" name="q${index}"> ${parts[3]}`;
                html += `</div>`;
                qContainer.innerHTML += html;
            });

            document.getElementById('loader-profile').style.display = 'none';
            document.getElementById('lbl-role').innerText = userProfile.role;
            goToSection('section-baseline');
        }

        // --- Baseline Analysis ---
        async function submitBaseline() {
            document.getElementById('loader-baseline').style.display = 'block';
            
            // Call AI to generate Roadmap
            const prompt = `Create a short, bulleted 4-step learning roadmap for a ${userProfile.role} focusing on: ${userProfile.skills}. Keep it concise.`;
            const roadmap = await callGemini(prompt);

            // Mock scoring logic (Random for demo, real would check answers)
            score = Math.floor(Math.random() * (60 - 30 + 1) + 30); // Initial baseline is usually low

            // Populate Dashboard
            document.getElementById('dash-name').innerText = userProfile.name;
            document.getElementById('dash-score').innerText = score + "%";
            document.getElementById('dashboard-roadmap').innerText = roadmap;
            document.getElementById('dash-tech-text').innerText = `Specific to ${userProfile.role}`;

            document.getElementById('loader-baseline').style.display = 'none';
            goToSection('section-dashboard');
        }

        // --- Resume Builder ---
        async function optimizeResume() {
            const input = document.getElementById('resume-input').value;
            if(!input) return;

            document.getElementById('loader-resume').style.display = 'block';
            const prompt = `Rewrite this resume summary to be professional, ATS-friendly, and result-oriented for a ${userProfile.role}: "${input}"`;
            
            const result = await callGemini(prompt);
            
            document.getElementById('resume-output').style.display = 'block';
            document.getElementById('resume-output').innerText = result;
            document.getElementById('loader-resume').style.display = 'none';
        }

        // --- AI Mock Interview ---
        function addToChat(text, sender) {
            const div = document.createElement('div');
            div.className = `message ${sender === 'user' ? 'user-msg' : 'bot-msg'}`;
            div.innerText = text;
            const container = document.getElementById('chat-container');
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
            
            // Add to history
            chatHistory.push(`${sender === 'user' ? 'Candidate' : 'Interviewer'}: ${text}`);
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const text = input.value;
            if(!text) return;

            addToChat(text, 'user');
            input.value = '';

            const mode = document.getElementById('interview-mode').value;
            document.getElementById('lbl-mode').innerText = mode;
            document.getElementById('lbl-mock-role').innerText = userProfile.role;

            // Simple context construction
            const context = chatHistory.slice(-5).join('\n'); // keep last 5 turns
            const prompt = `
            Context: This is a ${mode} interview for a ${userProfile.role}.
            History: ${context}
            Candidate just said: "${text}"
            
            Respond as the interviewer. If the answer is good, ask the next relevant question. If bad, dig deeper. Keep response under 50 words.
            `;

            const reply = await callGemini(prompt, `You are a strict but fair ${mode} interviewer.`);
            addToChat(reply, 'bot');
        }

        async function endInterview() {
            goToSection('section-eval');
            document.getElementById('eval-content').innerText = "Analyzing interview performance...";
            
            const transcript = chatHistory.join('\n');
            const prompt = `
            Analyze this interview transcript for a ${userProfile.role} role.
            Transcript:
            ${transcript}

            Provide:
            1. Strong Points
            2. Weak Areas
            3. Final Verdict (Hire/No Hire)
            `;

            const feedback = await callGemini(prompt);
            document.getElementById('eval-content').innerText = feedback;
            
            // Boost score based on completion
            score = Math.min(100, score + 20);
            document.getElementById('final-score').innerText = score + "/100";
        }

    </script>
</body>
</html>
